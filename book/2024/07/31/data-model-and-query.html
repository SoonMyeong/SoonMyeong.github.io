<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>데이터중심 애플리케이션 설계 - 2장 데이터 모델과 질의 언어 | SoonWorld</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="데이터중심 애플리케이션 설계 - 2장 데이터 모델과 질의 언어" />
<meta name="author" content="Soon" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="목차" />
<meta property="og:description" content="목차" />
<link rel="canonical" href="https://soonmyeong.github.io/jekyll-theme-yat/book/2024/07/31/data-model-and-query.html" />
<meta property="og:url" content="https://soonmyeong.github.io/jekyll-theme-yat/book/2024/07/31/data-model-and-query.html" />
<meta property="og:site_name" content="SoonWorld" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-31T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="데이터중심 애플리케이션 설계 - 2장 데이터 모델과 질의 언어" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Soon"},"dateModified":"2024-07-31T00:00:00+00:00","datePublished":"2024-07-31T00:00:00+00:00","description":"목차","headline":"데이터중심 애플리케이션 설계 - 2장 데이터 모델과 질의 언어","mainEntityOfPage":{"@type":"WebPage","@id":"https://soonmyeong.github.io/jekyll-theme-yat/book/2024/07/31/data-model-and-query.html"},"url":"https://soonmyeong.github.io/jekyll-theme-yat/book/2024/07/31/data-model-and-query.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="">
  <link rel="canonical" href="https://SoonMyeong.github.io">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/jekyll-theme-yat/assets/css/main.css">
  <script src="/jekyll-theme-yat/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="https://soonmyeong.github.io/jekyll-theme-yat/feed.xml" title="SoonWorld" /><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8"
        src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"
        async></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
<script
  src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe-lightbox.umd.min.js" async></script>
<script
  src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe.umd.min.js" async></script>
<link
  href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/photoswipe.min.css"
  rel="stylesheet"
/>
<style>
  .pswp .pswp__container .pswp__img {
    background-color: white;
  }
</style>

<script>
  function initPhotoSwipe() {
    let customOptions = {};

    try {
      const data = ``.replaceAll("=>", ":");
      customOptions = JSON.parse(data);
    } catch (e) {
      console.info("Invalid custom photo previewer options! " + e.message);
    }

    // Define object and gallery options
    const options = Object.assign(
      {
        gallery: "section.main",
        children: "a.photo-swipe",
        photo_scale: 2,
        // dynamic import is not supported in UMD version
        pswpModule: PhotoSwipe,
      },
      customOptions
    );

    const galleryEl = document.querySelector(options.gallery);
    if (!galleryEl) {
      return;
    }

    const imgEls = [];
    const els = galleryEl.querySelectorAll("img:not(.emoji)");
    els.forEach((el) => {
      if (el.src.trim() == "") {
        return;
      }
      if (!imgEls.includes(el)) {
        imgEls.push(el);
      }
    });

    if (imgEls.length === 0) {
      return;
    }

    imgEls.forEach((imgEl) => {
      imgEl.outerHTML = `
      <a class="photo-swipe"
        href="${imgEl.src}"
        data-pswp-width="${
          Math.max(imgEl.naturalWidth, imgEl.width) * options.photo_scale
        }"
        data-pswp-height="${
          Math.max(imgEl.naturalHeight, imgEl.height) * options.photo_scale
        }"
        data-pswp-caption="${imgEl.getAttribute("caption") || imgEl.alt}"
        target="_blank">
        ${imgEl.outerHTML}
      </a>`;
    });

    // Initialize PhotoSwipe 5
    var lightbox = new PhotoSwipeLightbox(options);

    lightbox.init();
  }

  window.addEventListener("load", initPhotoSwipe);
</script>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner"><span class="site-brand"><a class="site-brand-inner" rel="author" href="/jekyll-theme-yat/">
  <img class="site-favicon" title="SoonWorld" src="" onerror="this.style.display='none'">
  SoonWorld
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>

          <div class="trigger"><a class="page-link" href="/jekyll-theme-yat/about.html">ABOUT</a><a class="page-link" href="/jekyll-theme-yat/archives.html">ARCHIVES</a><a class="page-link" href="/jekyll-theme-yat/categories.html">CATEGORIES</a><a class="page-link" href="/jekyll-theme-yat/">HOME</a><a class="page-link" href="/jekyll-theme-yat/tags.html">TAGS</a>









<span class="page-link">



<div id="google_translate_element" style="display: none;">
</div>

<span class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="fr">
          
          <img src="https://cdn.countryflags.com/thumbs/france/flag-400.png" title="French">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="zh-CN">
          
          <img src="https://cdn.countryflags.com/thumbs/china/flag-400.png" title="Chinese(Simple)">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ja">
          
          <img src="https://cdn.countryflags.com/thumbs/japan/flag-400.png" title="Japanese">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ko">
          
          <img src="https://cdn.countryflags.com/thumbs/south-korea/flag-400.png" title="Korean">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ru">
          
          <img src="https://cdn.countryflags.com/thumbs/russia/flag-400.png" title="Russian">
          
        </a>
      </li>
    
  </ul>
</span>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  // Links to cross-origin destinations are unsafe
  var gll = document.getElementsByClassName('goog-logo-link')[0];
  if (gll) {
    gll.setAttribute('rel', 'noopener');
  }

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>
</span></div>
        </nav></div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">데이터중심 애플리케이션 설계 - 2장 데이터 모델과 질의 언어</h1>
  <h2 class="post-subtitle">2장 데이터 모델과 질의 언어</h2>

  <div class="post-meta">
    <time class="dt-published" datetime="2024-07-31T00:00:00+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Jul 31, 2024
    </time>
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 21 mins</span>
  </div><div class="post-tags"><a class="post-tag" href="/jekyll-theme-yat/tags.html#datamodel">#datamodel</a><a class="post-tag" href="/jekyll-theme-yat/tags.html#sql">#sql</a></div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <h1 id="목차">목차</h1>

<h1 id="1-데이터-모델">1. 데이터 모델</h1>

<ul>
  <li>관계형 모델</li>
  <li>문서 모델</li>
  <li>그래프형 모델</li>
</ul>

<h1 id="2-데이터를-위한-질의-언어">2. 데이터를 위한 질의 언어</h1>

<ul>
  <li>선언형 질의</li>
  <li>맵리듀스 질의</li>
  <li>사이퍼 질의</li>
  <li>스파클 질의</li>
</ul>

<h1 id="내-언어의-한계는-내-세계의-한계를-의미한다"><em>“내 언어의 한계는 내 세계의 한계를 의미한다.”</em></h1>

<h2 id="루트비히-비트겐슈타인-논리-철학-논고1922">루트비히 비트겐슈타인, 논리-철학 논고(1922)</h2>

<h2 id="관계형-모델">관계형 모델</h2>

<ul>
  <li>오늘날 가장 잘 알려진 데이터 모델</li>
  <li>데이터는 (SQL 에서 테이블) 관계로 구성되고 각 관계는 순서 없는 튜플(SQL 에서 로우)의 모음</li>
  <li>이론적 제안으로부터 시작했으며 1980년대 중반 DBMS 와 SQL 은 정규화된 구조로 데이터 저장 및 질의할 필요가 있는 사람들 대부분이 선택하는 도구가 됨</li>
  <li>관계형 모델의 경쟁자들도 잠깐 등장했었지만.. 이내 사라져버렸음
    <ul>
      <li>객체 데이터베이스, XML 데이터베이스 등…</li>
    </ul>
  </li>
</ul>

<h3 id="nosql-의-탄생">NoSQL 의 탄생</h3>

<ul>
  <li>2010년대에 관계형 모델의 우위를 뒤집으려는 가장 최신 시도</li>
  <li>원래 NoSQL은 2009년에 오픈소스, 분산 환경, 비관계형 데이터베이스 밋업용 인기 트위터 해시태그였다.</li>
  <li>지금은 인기 있는 여러 데이터베이스 시스템과 #NoSQL 해시태그가 연관돼 있다.</li>
  <li>그래서 Not Only SQL 로 재해석됐다.
    <ul>
      <li>SQL만을 사용하지 않는 DBMS 를 지칭하는 단어 NoSQL,</li>
      <li>관계형 DB 뿐만 아니라 여려 유형의 데이터베이스도 사용한다
        <ul>
          <li>https://namu.wiki/w/NoSQL</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Why NoSQL ?
    <ul>
      <li>대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 DBMS 보다 쉽게 할 수 있는 확장성 만족</li>
      <li>상용 DB 제품 보다 무료 오픈소스 소프트웨어 선호도 확산</li>
      <li>DBMS 에서 지원하지 않는 특수 질의 동작</li>
      <li>DBMS 보다 더 동적이고 표현력이 풍부한 데이터 모델에 대한 바람..</li>
    </ul>
  </li>
  <li>가까운 미래에는 DBMS 와 비관계형 데이터스토어가 함께 사용될 것인데, 이러한 개념을 종종 “다중 저장소 지속성” 이라 한다.</li>
</ul>

<h2 id="관계형-모델의-단점은-무엇일까-문서-모델은-어떤가">관계형 모델의 단점은 무엇일까? 문서 모델은 어떤가?</h2>

<h3 id="객체와-관계형-간-불일치">객체와 관계형 간 불일치</h3>

<ul>
  <li>오늘날 대부분의 애플리케이션은 OOP 로 개발한다.</li>
  <li>이는 SQL 데이터 모델을 향한 공통된 비판을 불러온다!</li>
  <li>데이터를 관계형 테이블에 저장하려면 애플리케이션 코드와 데이터베이스 모델 객체(테이블,로우 컬럼) 사이에 거추장스러운 전환 계층이 필요하다..
    <ul>
      <li>“임피던스 불일치” 라고 부른다고 한다.</li>
    </ul>
  </li>
  <li>
    <p>액티브레코드(??) 나 하이버네이트 같은 객체 관계형 매핑 (ORM) 프레임워크는 전환 계층에 필요한 상용구 코드 (보일러플레이트 코드)의 양을 줄이지만 두 모델 간의 차이를 완벽히 숨기진 못한다.</p>
  </li>
  <li>예시) 관계형 스키마에서 이력서를 표현하는 방법</li>
</ul>

<p><img src="https://github.com/user-attachments/assets/6ac1d5e8-2043-4bc9-a5d2-255914fbc27b" alt="image" /></p>

<ul>
  <li>예시) 위 예시를 문서모델인 JSON 으로 표현하는 방법</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
	<span class="dl">"</span><span class="s2">user_id</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">251</span><span class="p">,</span>
	<span class="dl">"</span><span class="s2">first_name</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Bill</span><span class="dl">"</span><span class="p">,</span>
	<span class="dl">"</span><span class="s2">last_name</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Gates</span><span class="dl">"</span><span class="p">,</span>
	<span class="dl">"</span><span class="s2">summary</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Co-chair of the Bill &amp; Melinda Gates ...</span><span class="dl">"</span><span class="p">,</span>
	<span class="o">**</span><span class="dl">"</span><span class="s2">region_id</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">us:91</span><span class="dl">"</span><span class="p">,</span>
	<span class="dl">"</span><span class="s2">industry_id</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">131</span><span class="p">,</span><span class="o">**</span>
	
	<span class="dl">"</span><span class="s2">positions</span><span class="dl">"</span> <span class="p">:</span> <span class="p">[</span>
		<span class="p">{</span><span class="dl">"</span><span class="s2">job_title</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Co-chair</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">organization</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Bill &amp; Melinda Gates Foundation</span><span class="dl">"</span><span class="p">},</span>
		<span class="p">{</span><span class="dl">"</span><span class="s2">job_title</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Co-founder, Chairman</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">organization</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Microsoft</span><span class="dl">"</span><span class="p">}</span>
	<span class="p">],</span>
	
	<span class="p">...</span>
	<span class="dl">"</span><span class="s2">contact_info</span><span class="dl">"</span> <span class="p">:</span> <span class="p">{</span>
		<span class="dl">"</span><span class="s2">blog</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">http:// ...</span><span class="dl">"</span><span class="p">,</span>
		<span class="dl">"</span><span class="s2">twitter</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">http:// ...</span><span class="dl">"</span>
	<span class="p">}</span>
<span class="p">}</span>
	
</code></pre></div></div>

<ul>
  <li>“아 보기 좋다. JSON 모델 쓰면 임피던스 불일치를 줄일 수 있겠네”</li>
  <li>일부 개발자는 JSON 모델이 애플리케이션 코드와 저장 계층 간 임피던스 불일치를 줄인다고 생각한다.
    <ul>
      <li>4장에서 설명하지만 데이터 부호화 형식으로 JSON 이 가진 문제도 있음</li>
    </ul>
  </li>
  <li>JSON 표현은 다중 테이블 스키마보다 더 나은 <strong>“지역성”</strong>을 갖는다.
    <ul>
      <li>관계형 예제에서 프로필을 가져오려면 다중 질의 or 난잡한 다중 조인을 수행해야 함, but JSON 표현은 모든 관련 정보가 한 곳에 있어 질의 하나로 충분</li>
    </ul>
  </li>
  <li>일대다 관계는 의미상 <strong>데이터 트리구조와 같은데, JSON 표현에서 명시적으로 드러남.</strong></li>
</ul>

<p><img src="https://github.com/user-attachments/assets/114d900c-ce0d-4468-bae1-b99217c9a7a9" alt="image" /></p>

<h3 id="여기서-잠깐">여기서 잠깐..</h3>

<p>위 프로필 파일에서 왜 region_id 와 industry_id 는 문자로 표현하지 않았을까?</p>

<ul>
  <li>프로필 간 일관된 스타일과 철자</li>
  <li>모호함 회피 (같은 이름의 도시.. 가능성있음)</li>
  <li>갱신의 편의성</li>
  <li>현지화 지원</li>
  <li>더 나은 식별 ( ex. 지역목록에 시애틀이 워싱턴에 있다는 사실을 부호화)</li>
  <li>텍스트를 직접 저장 시 이를 사용하는 모든 레코드에서 정보를 중복으로 저장하게 된다.</li>
</ul>

<h3 id="그럼-id-쓰는-장점은">그럼 ID 쓰는 장점은..</h3>

<ul>
  <li>식별 정보를 변경해도 ID는 동일하게 유지할 수 있음
    <ul>
      <li>물론 ID가 의미를 가지는 경우 미래에 언젠가는 ID 를 변경해야 할 수도 있다.</li>
    </ul>
  </li>
  <li>만약 정보가 중복돼 있으면 모든 중복 항목을 변경 해야 한다.
    <ul>
      <li>이는 쓰기 오버헤드와 불일치 (일부 중복 항목이 갱신되지 않음) 위험이 있음.. 자세한건 3장</li>
    </ul>
  </li>
  <li>결국, 중복을 제거하는 일이 데이터베이스 정규화의 이면에 놓인 “핵심 개념” 이다.</li>
</ul>

<h3 id="중복된-데이터를-정규화-하려면">중복된 데이터를 정규화 하려면?</h3>

<ul>
  <li>다대일 관계가 필요함, 문서 모델에는 적합하지 않다.
    <ul>
      <li>RDB 는 조인이 쉽기 때문에 ID 로 다른 테이블의 로우를 참조하는 방식이 일반적임</li>
    </ul>
  </li>
  <li>문서 DB 는 일대다 트리 구조를 위해 조인이 필요하진 않다.(아까 예제) 그치만 조인에 대한 지원은 보통 약한 편임. ( ex. 몽고DB 의 조인 부재, 리싱크DB 는 조인을 지원하긴 함)
    <ul>
      <li>데이터베이스 자체가 조인을 지원 안하면?
        <ul>
          <li>다중 질의를 만들어 애플리케이션 코드에서 조인을 흉내내면 되긴함</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>어쨋든 애플리케이션의 초기 버전이 조인 없는 문서 모델에 적합할지라도 기능이 추가되다 보면 결국 데이터는 상호 연결되는 경향이 있음.</li>
</ul>

<p><img src="https://github.com/user-attachments/assets/12f5e7f6-b303-4e47-8eb9-3daafcf019f3" alt="image" /></p>

<ul>
  <li>다대다 관계로 프로필이 확장 된 데이터 모델 형태
    <ul>
      <li>점선 내 데이터는 하나의 문서로 묶을 수 있으나 조직,학교, 기타 사용자는 참조로 표현해야 하고 질의할 때 조인이 필요함</li>
    </ul>
  </li>
  <li>document DB가 이렇게 허무하게 끝날 순 없다. 조금 더 살펴보자.</li>
</ul>

<h2 id="문서-데이터베이스의-역사">문서 데이터베이스의 역사</h2>

<ul>
  <li>이를 논하기 위해서는 가장 초기 전산화 데이터베이스 시스템으로 돌아간다…</li>
  <li>1970년대 비즈니스 데이터 처리를 위해 가장 많이 사용한 DB 는 IBM 의 IMS(정보 관리 시스템) 이였다.
    <ul>
      <li>계층 모델 이라 부르는 데이터 모델을 사용</li>
      <li>계층 모델은 JSON 모델과 비슷하다.</li>
      <li>역시나 IMS 도 일대다 관계에서는 잘 동작했다.. 문제는 다대다 관계 표현이였다..
        <ul>
          <li>오늘날 문서DB 를 사용해 작업 중인 개발자가 풀어야 할 문제와 매우 비슷하다.</li>
        </ul>
      </li>
      <li>계층 모델의 한계를 해결하기 위해 두드러지는 해결책은 2가지였다.
        <ul>
          <li>관계형 모델, 네트워크 모델</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="네트워크-모델에-대해">네트워크 모델에 대해</h3>

<ul>
  <li>코다실(CODASYL) 이라 불리는 위원회에서 표준화했으며 코다실 모델이라고도 부른다.</li>
  <li>코다실 모델은 <strong>계층 모델을 일반화</strong> 한다.
    <ul>
      <li>계층 모델의 트리 구조에서 모든 레코드는 정확히 하나의 부모가 있다.</li>
      <li>근데 네트워크 모델은 부모가 다중 부모….
        <ul>
          <li>ex. “그레이터 시애틀 구역” 지역을 위한 하나의 레코드는 이 지역에 사는 모든 사용자에 연결될 수 있다, 다대일과 다대다 관계를 모델링 할 수 있음.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>레코드 간 연결은 외래 키 보다 프로그래밍 언어의 포인터와 더 비슷함 (디스크에 저장은 됨)</li>
  <li>레코드에 접근하는 방법은 최상위 레코드에서부터 연속된 연결 경로를 따르는 방법밖에 없다.
    <ul>
      <li>이를 “접근 경로” 라 한다.</li>
      <li>다대다 관계의 세계에서 다양한 다른 경로를 계속 추적해야 함..</li>
    </ul>
  </li>
  <li>그렇다면 레코드 질의는 ??
    <ul>
      <li>레코드 목록을 반환해 접근 경로를 따라 데이터베이스의 끝에서 끝까지 커서를 움직여 수행..</li>
      <li>레코드가 다중 부모면.. 다양한 관계를 모두 추적해야 한다.</li>
      <li>코다실 위원회도 이 방식이 n차원 데이터 공간을 항해하는것과 같다고 인정함</li>
    </ul>
  </li>
</ul>

<h3 id="관계형-데이터베이스와-문서-데이터베이스와의-비교">관계형 데이터베이스와 문서 데이터베이스와의 비교</h3>

<ul>
  <li>RDB 와 다르게 별도 테이블이 아닌 상위 레코드 내에 중첩된 레코드(일대다관계) 를 저장한다.</li>
  <li>다대일, 다대다 관계를 표현할 때 관계형 모델은 “외래키” 라는 식별자로 참조 하고 문서 모델에서는 “문서 참조” 라 부른다.</li>
</ul>

<h2 id="관계형-데이터베이스와-문서-데이터베이스">관계형 데이터베이스와 문서 데이터베이스</h2>

<ul>
  <li>두 DB 를 비교할 경우 내결함성, 동시성 처리 등 고려해야할 차이점이 있지만, 이번 장에서는 데이터 모델 차이점만 집중할 것임</li>
  <li>문서 데이터 모델을 선호하는 이유
    <ul>
      <li>스키마 유연성, 지역성에 기안한 더 나은 성능</li>
      <li>일부 애플리케이션의 경우 애플리케이션에서 쓰는 데이터 구조와 더 가까움</li>
    </ul>
  </li>
</ul>

<h3 id="어떤-데이터-모델이-애플리케이션-코드를-더-간단히-할까">어떤 데이터 모델이 애플리케이션 코드를 더 간단히 할까?</h3>

<ul>
  <li>애플리케이션에서 쓰는 데이터가 문서와 비슷한 구조라면 문서 모델을 사용하는 것이 좋음</li>
  <li>문서 모델에는 제한이 있음
    <ul>
      <li>문서 내 중첩 항목을 바로 참조할 수 없어서 (조인불가), 하지만 너무 깊게만 중첩되지 않으면 크게 문제가 되지 않음</li>
    </ul>
  </li>
  <li>애플리케이션에서 다대다 관계를 사용하면 문서 모델은 매력도 감소!</li>
</ul>

<h3 id="문서-모델의-스키마-유연성">문서 모델의 스키마 유연성</h3>

<ul>
  <li>문서 데이터베이스는 종종 스키마리스(schemaless)로 불리지만 이는 오해의 소지가 있다.
    <ul>
      <li>데이터를 읽는 코드는 보통 구조의 유형을 어느 정도 가정한다.</li>
      <li>즉, 암묵적 스키마는 있지만 데이터베이스가 강요하진 않음</li>
      <li>용어로 말하면 읽기스키마 라 할 수 있다.
        <ul>
          <li>데이터 구조는 암묵적이고 데이터를 읽을 때만 해석된다.</li>
        </ul>
      </li>
      <li>그럼 쓰기스키마는?
        <ul>
          <li>RDB 의 전통적 접근방식, 스키마는 명시적이고 DB 에 쓰여진 모든 데이터가 스키마를 따르고 있음을 보장</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>근데 이게 뭐?
    <ul>
      <li>스키마와 관련된 자세한 내용은 4장에서..</li>
    </ul>
  </li>
</ul>

<h3 id="문서-데이터베이스와-관계형-데이터베이스-통합">문서 데이터베이스와 관계형 데이터베이스 통합</h3>

<ul>
  <li>RDB 와 DocumentDB 는 시간이 지남에 따라 점점 더 비슷해지고 있다.</li>
</ul>

<h2 id="그래프형-데이터-모델">그래프형 데이터 모델</h2>

<ul>
  <li>앞에서 다대다 관계가 다양한 데이터 모델을 구별하는 중요한 기능임을 살펴봤다.</li>
  <li>다대다 관계가 매우 일반적인 경우라면?
    <ul>
      <li>관계형 모델은 단순한 다대다는 다룰 수 있으나 연결이 더 복잡해지면 그래프로 데이터를 모델링하기 시작하는 편이 더 자연스럽다.</li>
    </ul>
  </li>
  <li>그래프
    <ul>
      <li>정점(vertex, 노드나 엔티티) 간선 (edge, 관계나 호(arc))</li>
      <li>ex. 소셜 그래프 (정점 : 사람, 간선 : 사람 간 서로 알고 있음)</li>
      <li>ex. 웹 그래프 (정점 : 웹 페이지, 간선 : 다른 페이지에 대한 HTML 링크)</li>
      <li>ex. 도로나 철도 네트워크 (정점 : 교차로, 간선 : 교차로 간 도로나 철로 선)</li>
    </ul>
  </li>
</ul>

<p><img src="https://github.com/user-attachments/assets/126bb8f1-efe8-46f5-b02e-4d7018110329" alt="image" /></p>

<ul>
  <li>이번 장에서는 속성 그래프모델과 트리플 저장소모델 에 대해 알아봄</li>
</ul>

<h3 id="속성-그래프">속성 그래프</h3>

<ul>
  <li>정점(vertex)
    <ul>
      <li>고유한 식별자</li>
      <li>유출(outgoing) 간선 집합</li>
      <li>유입(incoming) 간선 집합</li>
      <li>속성 컬렉션 (키-값 쌍)</li>
    </ul>
  </li>
  <li>간선(edge)
    <ul>
      <li>고유한 식별자</li>
      <li>간선이 시작하는 정점(꼬리 정점)</li>
      <li>간선이 끝나는 정점 (머리 정점)</li>
      <li>두 정점 간 관계 유형을 설명하는 레이블</li>
      <li>속성 컬렉션(키-값 쌍)</li>
    </ul>
  </li>
  <li>관계형 스키마를 사용해 속성 그래프 표현 하기</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">vertices</span> <span class="p">(</span>
	<span class="nx">vertex_id</span> <span class="nx">integer</span> <span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">,</span>
	<span class="nx">properties</span> <span class="nx">json</span>
<span class="p">);</span>

<span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">edges</span> <span class="p">(</span>
	<span class="nx">edge_id</span> <span class="nx">integer</span> <span class="nx">PRIMARY</span> <span class="nx">KEY</span><span class="p">,</span>
	<span class="nx">tail_vertex</span> <span class="nx">integer</span> <span class="nx">REFERENCES</span> <span class="nx">vertices</span><span class="p">(</span><span class="nx">vertex_id</span><span class="p">),</span>
	<span class="nx">head_vertex</span> <span class="nx">integer</span> <span class="nx">ERFERENCES</span> <span class="nx">vertices</span><span class="p">(</span><span class="nx">vertex_id</span><span class="p">),</span>
	<span class="nx">label</span> <span class="nx">text</span><span class="p">,</span>
	<span class="nx">properties</span> <span class="nx">json</span>
<span class="p">);</span>

<span class="nx">CREATE</span> <span class="nx">INDEX</span> <span class="nx">egdes_tails</span> <span class="nx">ON</span> <span class="nx">edges</span> <span class="p">(</span><span class="nx">tail_vertex</span><span class="p">);</span>
<span class="nx">CREATE</span> <span class="nx">INDEX</span> <span class="nx">edges_heads</span> <span class="nx">ON</span> <span class="nx">edges</span> <span class="p">(</span><span class="nx">head_vertex</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>이 모델의 중요 포인트
    <ul>
      <li>정점은 다른 정점과 간선으로 연결됨. 특정 유형 제한하는 스키마 없음</li>
      <li>일련의 정점을 따라 앞뒤 방향으로 순회 (그래서 앞뒤로 인덱스 만듬)</li>
      <li>다른유형의 관계일 경우 다른 레이블을 사용하여 단일 그래프에 다른 유형의 정보를 저장할 수 있음</li>
    </ul>
  </li>
  <li>위 그림 2-5를 관계형 스키마로 표현했을 때 어려운 사례는?
    <ul>
      <li>국가마다 지역구조가 다름..</li>
    </ul>
  </li>
  <li>그래프는 발전성이 좋아 애플리케이션에 기능을 추가하는 경우 데이터 구조 변경을 수용하게끔 쉽게 확장할 수 있음
    <ul>
      <li>루시가 먹을 수 있는 안전한 음식이 무엇인가?</li>
    </ul>

    <p><img src="https://github.com/user-attachments/assets/3812f70a-84be-4403-b058-997eeb6a6b63" alt="image" /></p>
  </li>
</ul>

<h3 id="트리플-저장소">트리플 저장소</h3>

<ul>
  <li>트리플 저장소는 속성 그래프 모델과 거의 동등</li>
  <li>모든 정보를 주어(subject), 서술어 (predicate), 목적어 (object) 처럼 매우 간단한 세 부분 구문 형식으로 저장</li>
  <li>주어는 그래프의 정점(vertex)과 같음</li>
  <li>목적어,서술어
    <ul>
      <li>문자열이나 숫자 같은 원시 데이터타입값 일 경우
        <ul>
          <li>트리플의 서술어와 목적어는 주어 정점에서 속성의 키,값과 동등</li>
          <li>ex. (루시,나이,33) {”age” :33} 속성을 가진 정점 lucy</li>
        </ul>
      </li>
      <li>그래프의 다른 정점일 경우
        <ul>
          <li>서술어는 그래프의 간선, 주어는 꼬리 정점, 목적어는 머리 정점</li>
          <li>ex. (루시,결혼하다,알랭)  루시와 알랭은 정점, 서술어 결혼하다는 정점을 잇는 간선의 레이블</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>아…. 패스</li>
</ul>

<h3 id="그래프-데이터베이스와-네트워크-모델의-비교">그래프 데이터베이스와 네트워크 모델의 비교</h3>

<ul>
  <li>코다실 DB 에는 다른 레코드 타입과 중첩 가능한 레코드 타입을 지정하는 스키마가 있음.
    <ul>
      <li>근데 그래프 DB는 제한 없음. 모든 정점은 다른 정점으로 가는 간선을 가질 수 있음→ 그래프 DB 가 더 변화에 유연함</li>
    </ul>
  </li>
  <li>코다실 DB 에서 특정 레코드에 도달하는 유일한 방법은 레코드의 접근 경로 중 하나를 탐색 하는 방식임
    <ul>
      <li>그래프DB는 고유 ID를 가지고 임의 정점을 직접 참조하거나 색인을 사용해 특정 값을 가진 정점을 빠르게 찾을 수 있음</li>
    </ul>
  </li>
  <li>코다실에서 레코드의 하위 항목은 정렬된 집합이라 DB는 정렬을 유지해야하고 새로운 데이터 삽입 시 정렬된 집합에서 새로운 레코드 위치를 염두에 둬야 함
    <ul>
      <li>그래프DB는 정렬 안함, 질의를 만들 때만 결과 정렬할 수 있음</li>
    </ul>
  </li>
  <li>코다실은 모든 질의가 명령형이고 작성이 어렵고 스키마 변경 시 질의가 쉽게 손상 됨
    <ul>
      <li>그래프DB 는 사이퍼나 스파클 같은 고수준 선언형 질의 언어 제공</li>
    </ul>
  </li>
</ul>

<h2 id="데이터를-위한-질의-언어">데이터를 위한 질의 언어</h2>

<h3 id="선언형-질의-언어-sql">선언형 질의 언어 (SQL)</h3>

<ul>
  <li>목표를 달성하기 위한 방법이 아니라 알고자 하는 데이터의 패턴, 즉 결과가 충족해야 하는 조건과 데이터를 어떻게 변환할지를 지정하기만 하면 됨</li>
</ul>

<h3 id="맵리듀스-질의">맵리듀스 질의</h3>

<ul>
  <li>많은 컴퓨터에서 대량의 데이터를 처리하기 위한 프로그래밍 모델, 구글에 의해 널리 알려짐</li>
  <li>일부 NoSQL 데이터 저장소는 제한된 형태의 맵리듀스를 지원
    <ul>
      <li>읽기 전용 질의를 수행할 때 사용</li>
      <li>맵리듀스는 10장에서 자세히 설명</li>
    </ul>
  </li>
  <li>지금은 몽고DB 모델 사용에 대해 알아봄</li>
  <li>ex. 지금부터 한 달에 얼마나 자주 상어를 발견하는지 질의하기</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">SELECT</span> 
	<span class="nx">date_trunc</span><span class="p">(</span><span class="dl">'</span><span class="s1">month</span><span class="dl">'</span><span class="p">,</span> <span class="nx">observation_timestamp</span><span class="p">)</span> <span class="nx">AS</span> <span class="nx">observation_month</span>
	<span class="p">,</span> <span class="nx">sum</span><span class="p">(</span><span class="nx">num_animals</span><span class="p">)</span> <span class="nx">AS</span> <span class="nx">total_animals</span>
<span class="nx">FROM</span> <span class="nx">observations</span>
<span class="nx">WHERE</span> <span class="nx">family</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">sharks</span><span class="dl">'</span>
<span class="nx">GROUP</span> <span class="nx">BY</span> <span class="nx">observation_month</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>상어과에 속하는 종만 보이도록 관측치를 필터링 한 후 관측치가 발생한 달력의 월로 그룹화하고 마지막으로 해당 달의 모든 관측치에 보여진 동물 수를 합친다.</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">observations</span><span class="p">.</span><span class="nx">mapReduce</span><span class="p">(</span>
	<span class="kd">function</span> <span class="nx">map</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//2. js함수로 질의와 일치하는 모든 문서에 대해 한 번씩 호출</span>
		<span class="kd">var</span> <span class="nx">year</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">observationTimestamp</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">();</span>
		<span class="kd">var</span> <span class="nx">month</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">observationTimestamp</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="nx">emit</span><span class="p">(</span><span class="nx">year</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">-</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">month</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">numAnimals</span><span class="p">);</span>		
	<span class="p">},</span>
	
	<span class="kd">function</span> <span class="nx">reduce</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 3. map 이 방출한 키-값 쌍은 키로 그룹화</span>
		<span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">sum</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span> <span class="c1">//4. reduce 함수는 특정 월의 모든 관측치에 동물 수를 합침</span>
	<span class="p">},</span>
	
	<span class="p">{</span>
		<span class="na">query</span> <span class="p">:</span> <span class="p">{</span><span class="na">fimaily</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Sharks</span><span class="dl">"</span><span class="p">},</span> <span class="c1">//1.필터를 선언, 맵리듀스를 위한 몽고DB에 특화된 확장 프로그램</span>
		<span class="na">out</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">monthlySharkReport</span><span class="dl">"</span><span class="c1">// 5. 최종 출력을 monthlySharkReport 컬렉션에 기록</span>
	<span class="p">}</span>

<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>map 과 reduce 함수는 수행할 때 제약 사항이 있다.
    <ul>
      <li>pure(순수) 함수여야 한다.</li>
      <li>입력으로 전달된 데이터만 사용하고 추가적인 데이터베이스 질의를 수행할 수 없어야 하며, 사이드이펙트가 없어야 한다.
        <ul>
          <li>이 제약사항 때문에 DB가 임의 순서로 어디서나 이 함수를 실행할 수 있고 장애가 발생해도 함수를 재 실행할 수 있다.</li>
        </ul>
      </li>
      <li>문자열파싱 및 라이브러리 호출하고 계산 실행 등 작업에 이용할 수 있다.</li>
    </ul>
  </li>
  <li>몽고DB 에서 맵리듀스 사용성 문제는 연계된 JS 함수 두개(map, reduce) 를 신중하게 작성해야 한다는 점인데, 선언형 질의 언어는 옵티마이저가 질의 성능을 높일 수 있는 기회를 제공한다.
    <ul>
      <li>그래서 몽고 2.2 는 집계 파이프라인이라 부르는 선언형 질의 언어 지원을 추가함..</li>
    </ul>
  </li>
  <li>여기서 배울점은 NoSQL 시스템이 뜻하지 않게 SQL을 재발견하고 있다는 점임!</li>
</ul>

<h3 id="사이퍼-질의-언어">사이퍼 질의 언어</h3>

<ul>
  <li>속성 그래프를 위한 선언형 질의 언어
    <ul>
      <li>네오포제이 그래프 데이터베이스용으로 만들어짐</li>
    </ul>
  </li>
  <li>그림2-5의 왼쪽부분을 사이퍼 질의로 변경</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">CREATE</span>
	<span class="p">(</span><span class="nx">NAmerica</span><span class="p">:</span><span class="nx">Location</span> <span class="p">{</span><span class="nl">name</span><span class="p">:</span><span class="dl">'</span><span class="s1">North America</span><span class="dl">'</span><span class="p">,</span> <span class="nx">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">continent</span><span class="dl">'</span><span class="p">}),</span>
	<span class="p">(</span><span class="nx">USA</span><span class="p">:</span><span class="nx">Location</span> <span class="p">{</span><span class="nl">name</span><span class="p">:</span><span class="dl">'</span><span class="s1">United States</span><span class="dl">'</span><span class="p">,</span> <span class="nx">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">country</span><span class="dl">'</span><span class="p">}),</span>
	<span class="p">(</span><span class="nx">Idaho</span><span class="p">:</span><span class="nx">Location</span> <span class="p">{</span><span class="nl">name</span><span class="p">:</span><span class="dl">'</span><span class="s1">Idaho</span><span class="dl">'</span><span class="p">,</span> <span class="nx">type</span><span class="p">:</span><span class="dl">'</span><span class="s1">state</span><span class="dl">'</span><span class="p">}),</span>
	<span class="p">(</span><span class="nx">Lucy</span><span class="p">:</span><span class="nx">Person</span> <span class="p">{</span><span class="nl">name</span><span class="p">:</span><span class="dl">'</span><span class="s1">Lucy</span><span class="dl">'</span><span class="p">}),</span>
	
	<span class="p">(</span><span class="nx">Idaho</span><span class="p">)</span> <span class="o">-</span><span class="p">[:</span><span class="nx">WITHIN</span><span class="p">]</span><span class="o">-&gt;</span> <span class="p">(</span><span class="nx">USA</span><span class="p">)</span> <span class="p">[:</span><span class="nx">WITHIN</span><span class="p">]</span><span class="o">-&gt;</span> <span class="p">(</span><span class="nx">NAmerica</span><span class="p">),</span>
	<span class="p">(</span><span class="nx">Lucy</span><span class="p">)</span> <span class="o">-</span><span class="p">[:</span><span class="nx">BORN_IN</span><span class="p">]</span><span class="o">-&gt;</span> <span class="p">(</span><span class="nx">Idaho</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>하나더.. 미국에서 유럽으로 이민 온 모든사람들의 이름 찾기</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MATCH</span>
	<span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="o">-</span><span class="p">[:</span><span class="nx">BORN_IN</span><span class="p">]</span><span class="o">-&gt;</span> <span class="p">()</span> <span class="o">-</span><span class="p">[:</span><span class="nx">WITHIN</span><span class="o">*</span><span class="mi">0</span><span class="p">..]</span><span class="o">-&gt;</span> <span class="p">(</span><span class="nx">us</span><span class="p">:</span><span class="nx">Location</span> <span class="p">{</span><span class="nl">name</span><span class="p">:</span><span class="dl">'</span><span class="s1">United States</span><span class="dl">'</span><span class="p">}),</span>
	<span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="o">-</span><span class="p">[:</span><span class="nx">LIVES_IN</span><span class="p">]</span><span class="o">-&gt;</span> <span class="p">()</span> <span class="o">-</span><span class="p">[:</span><span class="nx">WITNIN</span><span class="o">*</span><span class="mi">0</span><span class="p">..]</span><span class="o">-&gt;</span> <span class="p">(</span><span class="nx">eu</span><span class="p">:</span><span class="nx">Location</span> <span class="p">{</span><span class="nl">name</span><span class="p">:</span><span class="dl">'</span><span class="s1">Europe</span><span class="dl">'</span><span class="p">})</span>

<span class="nx">RETURN</span> <span class="nx">person</span><span class="p">.</span><span class="nx">name</span>

<span class="c1">//person 은 어떤 정점을 향하는 BORN_IN 유출 간선을 가짐.</span>
<span class="c1">//이 정점에서 name 속성이 'United States'인 Location 유형의 정점에 도달할 떄 까지</span>
<span class="c1">//WITHIN 유출 간선을 따라감</span>

<span class="c1">//같은 person 정점은 LIVES_IN 유출 간선을 가짐, 이 간선과 WITHIN 유출 간선을 따라가면</span>
<span class="c1">//결국 name 속성이 "Europe" 인 유형의 정점에 도달</span>
</code></pre></div></div>

<ul>
  <li>보통 선언형 질의 언어는 질의 작성 시 수행에 대해 자세히 지정할 필요가 없다.. (feat. 옵티마이저)</li>
</ul>

<h3 id="sql의-그래프-질의">SQL의 그래프 질의</h3>

<ul>
  <li>RDB 에서 그래프 데이터를 표현할 수 있나? 넵
    <ul>
      <li>그치만 약간 어렵다.</li>
    </ul>
  </li>
  <li>가변 순회 경로에 대한 질의 개념을 “재귀 공통 테이블 식” 을 사용해 표현할 수 있다.
    <ul>
      <li>postgreSQL, IBM DB2, Oracle, SQL 서버에서 지원</li>
    </ul>
  </li>
  <li>위에서 본 미국에서 유럽으로 이민 온 모든사람들의 이름찾기를 재귀 공통 테이블식 문법을 사용해 질의 해보기</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">WITH</span> <span class="nx">RECURSIVE</span>
	<span class="o">--</span> <span class="nx">in_usa</span> <span class="nx">는</span> <span class="nx">미국</span> <span class="nx">내</span> <span class="nx">모든</span> <span class="nx">지역의</span> <span class="nx">정점</span> <span class="nx">ID</span> <span class="nx">집합이다</span><span class="p">.</span>
	<span class="nx">in_usa</span><span class="p">(</span><span class="nx">vertex_id</span><span class="p">)</span> <span class="nx">AS</span> <span class="p">(</span>
		<span class="nx">SELECT</span> <span class="nx">vertex_id</span> <span class="nx">FROM</span> <span class="nx">vertices</span> <span class="nx">WHERE</span> <span class="nx">properties</span><span class="o">-&gt;&gt;</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">United States</span><span class="dl">'</span>
		<span class="err">#</span> <span class="mi">1</span><span class="p">.</span> <span class="nx">name이</span> <span class="nx">미국인</span> <span class="nx">정점을</span> <span class="nx">찾아</span> <span class="nx">in_use</span> <span class="nx">정점</span> <span class="nx">집합의</span> <span class="nx">첫</span> <span class="nx">element로</span> <span class="nx">만든다</span><span class="p">.</span>
	<span class="nx">UNION</span>
		<span class="nx">SELECT</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">tail_vertex</span> <span class="nx">FROM</span> <span class="nx">edges</span>
			<span class="err">#</span> <span class="mi">2</span><span class="p">.</span> <span class="nx">in_use</span> <span class="nx">집합의</span> <span class="nx">정점들은</span> <span class="nx">모둔</span> <span class="nx">within</span> <span class="nx">유입</span> <span class="nx">간선을</span> <span class="nx">따라가</span> <span class="nx">같은</span> <span class="nx">집합에</span> <span class="nx">추가한다</span><span class="p">.</span>
			<span class="err">#</span> <span class="nx">모든</span> <span class="nx">within</span> <span class="nx">간선을</span> <span class="nx">방문할</span> <span class="nx">때까지</span> <span class="nx">수행한다</span><span class="p">.</span>
			<span class="nx">JOIN</span> <span class="nx">in_usa</span> <span class="nx">ON</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">head_vertex</span> <span class="o">=</span> <span class="nx">in_usa</span><span class="p">.</span><span class="nx">vertex_id</span>
			<span class="nx">WHERE</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">within</span><span class="dl">'</span>
<span class="p">),</span>
<span class="o">--</span> <span class="nx">in_europe</span> <span class="nx">은</span> <span class="nx">유럽</span> <span class="nx">내</span> <span class="nx">모든</span> <span class="nx">지역의</span> <span class="nx">정점</span> <span class="nx">ID</span> <span class="nx">집합이다</span><span class="p">.</span>
	<span class="nx">in_europe</span><span class="p">(</span><span class="nx">vertex_id</span><span class="p">)</span> <span class="nx">AS</span> <span class="p">(</span>
		<span class="nx">SELECT</span> <span class="nx">vertex_id</span> <span class="nx">FROM</span> <span class="nx">vertices</span> <span class="nx">WHERE</span> <span class="nx">properties</span><span class="o">-&gt;&gt;</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Europe</span><span class="dl">'</span>
		<span class="err">#</span> <span class="mi">3</span><span class="p">.</span> <span class="nx">name</span> <span class="nx">이</span> <span class="nx">유럽인</span> <span class="nx">정점을</span> <span class="nx">찾아</span> <span class="mi">1</span><span class="nx">번과</span> <span class="nx">동일하게</span> <span class="nx">in_europe</span> <span class="nx">집합을</span> <span class="nx">만든다</span><span class="p">.</span>
	<span class="nx">UNION</span>
		<span class="nx">SELECT</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">tail_vertex</span> <span class="nx">FROM</span> <span class="nx">edges</span>
		<span class="nx">JOIN</span> <span class="nx">in_europe</span> <span class="nx">ON</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">head_vertex</span> <span class="o">=</span> <span class="nx">in_europe</span><span class="p">.</span><span class="nx">vertex_id</span>
		<span class="nx">WHERE</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">within</span><span class="dl">'</span>
	<span class="p">),</span>
<span class="o">--</span> <span class="nx">born_in_usa</span> <span class="nx">는</span> <span class="nx">미국에서</span> <span class="nx">태어난</span> <span class="nx">모든</span> <span class="nx">사람의</span> <span class="nx">정점</span> <span class="nx">ID</span> <span class="nx">집합이다</span><span class="p">.</span>
	<span class="nx">born_in_usa</span><span class="p">(</span><span class="nx">vertex_id</span><span class="p">)</span> <span class="nx">AS</span> <span class="p">(</span> 
		<span class="err">#</span> <span class="mi">4</span><span class="p">.</span> <span class="nx">미국에서</span> <span class="nx">태어난</span> <span class="nx">사람을</span> <span class="nx">찾기</span> <span class="nx">위해</span> <span class="nx">in_usa</span> <span class="nx">집합의</span> <span class="nx">각</span> <span class="nx">정점에</span> <span class="nx">대해</span> <span class="nx">born_in</span> <span class="nx">incoming</span> <span class="nx">간선을</span> <span class="nx">따라간다</span>
		<span class="nx">SELECT</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">tail_vertex</span> <span class="nx">FROM</span> <span class="nx">edges</span>
			<span class="nx">JOIN</span> <span class="nx">in_usa</span> <span class="nx">ON</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">head_vertex</span> <span class="o">=</span> <span class="nx">in_usa</span><span class="p">.</span><span class="nx">vertex_id</span>
			<span class="nx">WHERE</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">born_in</span><span class="dl">'</span>
	<span class="p">),</span>

	<span class="o">--</span> <span class="nx">lives_in_europe</span> <span class="nx">은</span> <span class="nx">유럽에서</span> <span class="nx">태어난</span> <span class="nx">모든</span> <span class="nx">사람의</span> <span class="nx">정점</span> <span class="nx">ID</span> <span class="nx">집합이다</span><span class="p">.</span>
	<span class="nx">lives_in_europe</span><span class="p">(</span><span class="nx">vertex_id</span><span class="p">)</span> <span class="nx">AS</span> <span class="p">(</span>
		<span class="err">#</span> <span class="mi">5</span><span class="p">.</span> <span class="nx">동일하게</span> <span class="nx">유럽에</span> <span class="nx">사는</span> <span class="nx">사람을</span> <span class="nx">찾기</span> <span class="nx">위해</span> <span class="nx">in_europe</span> <span class="nx">집합의</span> <span class="nx">각</span> <span class="nx">정점에서</span> <span class="nx">lives_in</span> <span class="nx">incoming</span> <span class="nx">간선을</span> <span class="nx">따라간다</span>
		<span class="nx">SELECT</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">tail_vertex</span> <span class="nx">FROM</span> <span class="nx">edges</span>
			<span class="nx">JOIN</span> <span class="nx">in_europe</span> <span class="nx">ON</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">head_vertex</span> <span class="o">=</span> <span class="nx">in_europe</span><span class="p">.</span><span class="nx">vertex_id</span>
			<span class="nx">WHERE</span> <span class="nx">edges</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">lives_in</span><span class="dl">'</span>
	<span class="p">)</span>

<span class="nx">SELECT</span> <span class="nx">vertices</span><span class="p">.</span><span class="nx">properties</span><span class="o">-&gt;&gt;</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span>
<span class="nx">FROM</span> <span class="nx">vertices</span>
<span class="o">--</span> <span class="nx">미국에서</span> <span class="nx">태어나</span> <span class="nx">유럽에서</span> <span class="nx">자란</span> <span class="nx">사람을</span> <span class="nx">찾아</span> <span class="nx">join</span> <span class="nx">한다</span><span class="p">.</span>
<span class="nx">JOIN</span> <span class="nx">born_in_usa</span> <span class="nx">ON</span> <span class="nx">vertices</span><span class="p">.</span><span class="nx">vertex_id</span> <span class="o">=</span> <span class="nx">born_in_usa</span><span class="p">.</span><span class="nx">vertex_id</span>
<span class="err">#</span> <span class="nx">마지막으로</span> <span class="nx">join을</span> <span class="nx">이용해</span> <span class="nx">미국에서</span> <span class="nx">태어난</span> <span class="nx">사람과</span> <span class="nx">유럽에서</span> <span class="nx">태어난</span> <span class="nx">사람의</span> <span class="nx">교집함을</span> <span class="nx">구한다</span><span class="p">.</span>
<span class="nx">JOIN</span> <span class="nx">lives_in_europe</span> <span class="nx">ON</span> <span class="nx">vertices</span><span class="p">.</span><span class="nx">vertex_id</span> <span class="o">=</span> <span class="nx">lives_in_europe</span><span class="p">.</span><span class="nx">vertex_id</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>가능은..하다..</li>
</ul>

<h3 id="스파클sparql-질의">스파클(SPARQL) 질의</h3>

<ul>
  <li>RDF 데이터 모델을 사용한 트리플 저장소 질의 언어</li>
  <li>RDF 데이터 모델
    <ul>
      <li>Resource Description Framework</li>
      <li>서로 다른 웹 사이트가 일관된 형식으로 데이터를 게시하기 위한 방법을 제안</li>
    </ul>
  </li>
  <li>미국에서 유럽으로 이민 온 모든사람들의 이름찾기</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">PREFIX</span> <span class="p">:</span> <span class="o">&lt;</span><span class="nx">urn</span><span class="p">:</span><span class="nx">example</span><span class="p">:</span><span class="o">&gt;</span>

<span class="nx">SELECT</span> <span class="p">?</span><span class="nx">personName</span> <span class="nx">WEHRE</span> <span class="p">{</span>
	<span class="p">?</span><span class="nx">person</span> <span class="p">:</span><span class="nx">name</span> <span class="p">?</span><span class="nx">personName</span><span class="p">,</span>
	<span class="p">?</span><span class="nx">person</span> <span class="p">:</span><span class="nx">bornIn</span> <span class="o">/</span> <span class="p">:</span><span class="nx">within</span><span class="o">*</span> <span class="sr">/ :name "United States" </span><span class="err">.
</span>	<span class="p">?</span><span class="nx">person</span> <span class="p">:</span><span class="nx">liveIn</span> <span class="o">/</span> <span class="p">:</span><span class="nx">within</span><span class="o">*</span> <span class="sr">/ :name "Europe" </span><span class="err">.
</span><span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>구조는 사이퍼형태와 유사하다.
    <ul>
      <li>아래 두 표현식은 동등하다.
        <ul>
          <li>(person) -[:BORN_IN]-&gt; () -[:WITHIN*0..]-&gt; (location)  # 사이퍼</li>
          <li>?person :bornIn / :within* ?location #스파클</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="초석-데이터로그">초석: 데이터로그</h3>

<ul>
  <li>스파클이나 사이퍼보다 훨씬 오래된 언어 (1980년대 학계에서 광범위하게 연구됨)</li>
  <li>데이토믹을 질의 언어로 사용</li>
  <li>캐스캘로그는 데이터로그의 구현체로 하둡의 대용량 데이터셋 질의를 위한 용도</li>
</ul>


    </div>

</article>
<div class="post-nav"><a class="previous" href="/jekyll-theme-yat/book/2024/06/18/web-crawler.html" title="대규모시스템설계기초- 9장 웹크롤러 설계">대규모시스템설계기초- 9장 웹크롤러 설계</a><a class="next" href="/jekyll-theme-yat/book/2024/09/22/partitioning.html" title="데이터중심 애플리케이션 설계 - 파티셔닝">데이터중심 애플리케이션 설계 - 파티셔닝</a></div><div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li class="">
          <a class="post-link"
            href="/jekyll-theme-yat/book/2024/06/18/web-crawler.html"
            title="대규모시스템설계기초- 9장 웹크롤러 설계">
            대규모시스템설계기초- 9장 웹크롤러 설계<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li><li class="">
          <a class="post-link"
            href="/jekyll-theme-yat/book/2024/07/31/data-model-and-query.html"
            title="데이터중심 애플리케이션 설계 - 2장 데이터 모델과 질의 언어">
            데이터중심 애플리케이션 설계 - 2장 데이터 모델과 질의 언어<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li><li class="">
          <a class="post-link"
            href="/jekyll-theme-yat/book/2024/05/18/consistent-hash.html"
            title="대규모시스템설계기초- 5장 안정 해시 설계">
            대규모시스템설계기초- 5장 안정 해시 설계<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li><li class="">
          <a class="post-link"
            href="/jekyll-theme-yat/book/2024/09/22/partitioning.html"
            title="데이터중심 애플리케이션 설계 - 파티셔닝">
            데이터중심 애플리케이션 설계 - 파티셔닝<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li></ul>
    </div><div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/jekyll-theme-yat/"></data>

  <div class="wrapper">
    <div class="site-footer-inner"><div>Unpublished Work <span class="copyleft">&copy;</span> 2017-2024 Soon</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/jekyll-theme-yat/feed.xml">via RSS</a></div>
    </div>
  </div>
</footer>
</body>
</html>
